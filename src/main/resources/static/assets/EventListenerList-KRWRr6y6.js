import{_ as M}from"./TableHeader.vue_vue_type_script_setup_true_lang-DxGEwQb6.js";import{s as L,_ as S}from"./request-DFXc9TFQ.js";import{d as C,u as I,r as c,c as V,w as q,o as $,M as R,a as b,b as e,t as x,k as A,j as T,e as N,g as D,v as Y,F as G,f as j,h as p,i as _}from"./index-BHJqyt07.js";import{g as z,P as H}from"./ParamForm-C4bNCyBe.js";const J=()=>L.get("/eventlistener/list");function K(l){return L.get("/eventlistener/"+l)}function O(l){return L.get(`/eventlistener/duplicate?eventlistenerName=${l}`)}function Q(l){return L.post("/eventlistener",l)}function X(l){return L.patch(`/eventlistener/${l.eventListenerIdx}`,l)}function Z(l){return L.delete(`/eventlistener/${l}`)}const ee={class:"modal-dialog modal-lg modal-dialog-centered",role:"document",style:{"max-width":"900px"}},te={class:"modal-content"},ne={class:"modal-header"},se={class:"modal-title"},ae={class:"modal-body py-4"},le={class:"row mb-3"},oe={class:"grid gap-0 column-gap-3"},re={key:1,class:"btn btn-success",style:{margin:"3px",width:"150px"}},ie={class:"mb-3"},de={class:"mb-3"},ce=["value"],ue={class:"modal-footer"},ve=C({__name:"eventListenerForm",props:{mode:{},eventListenerIdx:{}},emits:["get-event-listener-list"],setup(l,{emit:g}){const s=I(),v=c(),m=c(),u=l,f=g,r=V(()=>u.eventListenerIdx);q(r,async()=>{await w(),await i()}),$(async()=>{v.value&&(m.value=new R(v.value)),await w(),await i()});const n=c({}),k=c(!1),w=async()=>{if(u.mode==="new")n.value.eventListenerName="",n.value.eventListenerDesc="",n.value.workflowIdx=0,n.value.workflowParams=[],o.value=!1,k.value=!0;else{const{data:a}=await K(u.eventListenerIdx);n.value=a,o.value=!0,k.value=!0}},y=c([]),i=async()=>{const{data:a}=await z("N");y.value=a},o=c(!1),E=async()=>{const{data:a}=await O(n.value.eventListenerName);a?s.error("Name is already in use."):(s.success("Name is available."),o.value=!0)},h=async()=>{if(!n.value.eventListenerName){s.error("Please enter Event Listener name.");return}if(!o.value){s.error("Please perform duplicate check for the name.");return}if(!n.value.eventListenerDesc){s.error("Please enter Event Listener description.");return}if(!n.value.workflowIdx||n.value.workflowIdx===0){s.error("Please select a Workflow.");return}let a=!1;u.mode==="new"?(n.value.workflowParams.forEach(t=>{t.paramIdx=0,t.eventListenerYn="Y"}),a=await F()):a=await P(),a&&(f("get-event-listener-list"),w(),m.value&&(m.value.hide(),setTimeout(()=>{document.body.classList.remove("modal-open");const t=document.querySelector(".modal-backdrop");t==null||t.remove()},150)))},F=async()=>{try{const{data:a}=await Q(n.value);return a?(s.success("Registered successfully."),!0):(s.error("Failed to register."),!1)}catch{return s.error("Failed to register."),!1}},P=async()=>{try{const{data:a}=await X(n.value);return a?(s.success("Updated successfully."),!0):(s.error("Failed to update."),!1)}catch{return s.error("Failed to update."),!1}},U=()=>{o.value=!1},W=a=>{y.value.forEach(t=>{t.workflowInfo.workflowIdx===a&&(n.value.workflowParams=t.workflowParams)})};return(a,t)=>(p(),b("div",{class:"modal modal-blur fade",id:"eventListenerForm",tabindex:"-1","aria-hidden":"true",ref_key:"modalElement",ref:v},[e("div",ee,[e("div",te,[e("div",ne,[e("h3",se,"Event Listener "+x(u.mode==="new"?"New":"Edit"),1),t[6]||(t[6]=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),e("div",ae,[e("div",null,[e("div",le,[t[7]||(t[7]=e("label",{class:"form-label required"},"Event Listener Name",-1)),e("div",oe,[N(e("input",{type:"text",class:"form-control p-2 g-col-11",placeholder:"Enter Event Listener Name","onUpdate:modelValue":t[0]||(t[0]=d=>n.value.eventListenerName=d),onFocus:U},null,544),[[D,n.value.eventListenerName]]),o.value?(p(),b("button",re,"Duplicate Check")):(p(),b("button",{key:0,class:"btn btn-primary chk",onClick:E,style:{margin:"3px",width:"150px"}},"Duplicate Check"))])]),e("div",ie,[t[8]||(t[8]=e("label",{class:"form-label required"},"Event Listener Description",-1)),N(e("input",{type:"text",class:"form-control p-2 g-col-11",placeholder:"Enter Event Listener Description","onUpdate:modelValue":t[1]||(t[1]=d=>n.value.eventListenerDesc=d)},null,512),[[D,n.value.eventListenerDesc]])]),e("div",de,[t[10]||(t[10]=e("label",{class:"form-label required"},"Workflow",-1)),N(e("select",{class:"form-select p-2 g-col-12","onUpdate:modelValue":t[2]||(t[2]=d=>n.value.workflowIdx=d),onChange:t[3]||(t[3]=d=>W(n.value.workflowIdx))},[t[9]||(t[9]=e("option",{value:0},"Select Workflow",-1)),(p(!0),b(G,null,j(y.value,(d,B)=>(p(),b("option",{value:d.workflowInfo.workflowIdx,key:B},x(d.workflowInfo.workflowName),9,ce))),128))],544),[[Y,n.value.workflowIdx]])]),k.value?(p(),A(H,{key:0,popup:!1,"workflow-param-data":n.value.workflowParams,"event-listener-yn":"Y",style:{margin:"0 !important"}},null,8,["workflow-param-data"])):T("",!0)])]),e("div",ue,[e("button",{type:"button",class:"btn btn-link link-secondary","data-bs-dismiss":"modal",onClick:t[4]||(t[4]=d=>w())}," Cancel "),e("button",{type:"button",class:"btn btn-primary ms-auto",onClick:t[5]||(t[5]=d=>h())},x(u.mode==="new"?"Create":"Edit"),1)])])])],512))}}),me={class:"modal modal-blur fade",id:"deleteEventListener",tabindex:"-1","aria-hidden":"true"},fe={class:"modal-dialog modal-lg modal-dialog-centered",role:"document"},we={class:"modal-content"},pe={class:"modal-body py-4"},be={class:"modal-footer"},Le=C({__name:"deleteEventListener",props:{eventListenerName:{},eventListenerIdx:{}},emits:["get-event-listener-list"],setup(l,{emit:g}){const s=I(),v=l,m=g,u=async()=>{const{data:f}=await Z(v.eventListenerIdx);f?s.success("삭제되었습니다."):s.error("삭제하지 못했습니다."),m("get-event-listener-list")};return(f,r)=>(p(),b("div",me,[e("div",fe,[e("div",we,[r[2]||(r[2]=e("div",{class:"modal-status bg-danger"},null,-1)),r[3]||(r[3]=e("div",{class:"modal-header"},[e("h3",{class:"modal-title"},"Delete Event Listener"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",pe,[e("h4",null,x(v.eventListenerName)+"을(를) 정말 삭제하시겠습니까?",1)]),e("div",be,[r[1]||(r[1]=e("a",{href:"#",class:"btn btn-link link-secondary","data-bs-dismiss":"modal"}," Cancel ",-1)),e("a",{href:"#",class:"btn btn-primary ms-auto","data-bs-dismiss":"modal",onClick:r[0]||(r[0]=n=>u())}," 삭제 ")])])])]))}}),ge={class:"card card-flush w-100"},ke={class:"card-body"},he=C({__name:"EventListenerList",setup(l){const g=I(),s=c([]),v=c([]);$(async()=>{n(),await m()});const m=async()=>{try{const{data:i}=await J();s.value=i,s.value.forEach(o=>{o.eventListenerUrl=u(o.eventListenerCallUrl)})}catch(i){console.log(i),g.error("데이터를 가져올 수 없습니다.")}},u=i=>window.location.origin+i,f=c(0),r=c(""),n=()=>{v.value=[{title:"Event Listener Name",field:"eventListenerName",width:"20%"},{title:"Connect Workflow Name",field:"workflowName",width:"20%"},{title:"Event Listener Desc",field:"eventListenerDesc",width:"20%"},{title:"Action URL",field:"eventListenerUrl",width:"20%"},{title:"Action",width:"20%",formatter:k,cellClick:function(i,o){const E=i.target,h=E==null?void 0:E.getAttribute("id");f.value=o.getRow().getData().eventListenerIdx,h==="edit-btn"?w.value="edit":r.value=o.getRow().getData().eventListenerName}}]},k=()=>`
  <div>
    <button
      class='btn btn-primary d-none d-sm-inline-block mr-5'
      id='edit-btn'
      data-bs-toggle='modal' 
      data-bs-target='#eventListenerForm'>
      수정
    </button>
    <button
      class='btn btn-danger d-none d-sm-inline-block'
      id='delete-btn'
      data-bs-toggle='modal' 
      data-bs-target='#deleteEventListener'>
      삭제
    </button>
  </div>`,w=c("new"),y=()=>{f.value=0,w.value="new"};return(i,o)=>(p(),b("div",null,[_(M,{"header-title":"Event Listener","new-btn-title":"New Event Listener","popup-flag":!0,"popup-target":"#eventListenerForm",class:"mb-3",onClickNewBtn:y}),e("div",ge,[e("div",ke,[_(S,{columns:v.value,"table-data":s.value},null,8,["columns","table-data"])])]),_(ve,{style:{width:"100%"},mode:w.value,"event-listener-idx":f.value,onGetEventListenerList:m},null,8,["mode","event-listener-idx"]),_(Le,{"event-listener-name":r.value,"event-listener-idx":f.value,onGetEventListenerList:m},null,8,["event-listener-name","event-listener-idx"])]))}});export{he as default};
