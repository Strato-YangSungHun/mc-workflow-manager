import{_ as R}from"./TableHeader.vue_vue_type_script_setup_true_lang-DxGEwQb6.js";import{s as v,_ as j}from"./request-DFXc9TFQ.js";import{d as C,u as D,r as d,c as $,w as F,o as E,M as z,a as u,b as e,t as h,j as G,e as T,v as O,F as L,f as H,g as _,h as f,i as x}from"./index-BHJqyt07.js";const J=()=>v.get("/workflowStageType/list"),K=()=>v.get("/workflowStage/list");function Q(s){return v.get("/workflowStage/"+s)}function X(s){return v.get(`/workflowStage/duplicate?workflowStageName=${s.workflowStageName}&workflowStageTypeName=${s.workflowStageTypeName}`)}function Y(s){return v.post("/workflowStage",s)}function Z(s){return v.patch(`/workflowStage/${s.workflowStageIdx}`,s)}function ee(s){return v.delete(`/workflowStage/${s}`)}function te(s){return v.get(`/workflowStage/default/script/${s}`)}const oe={class:"modal-dialog modal-lg modal-dialog-centered",role:"document"},ae={class:"modal-content"},le={class:"modal-header"},se={class:"modal-title"},re={class:"modal-body py-4"},ne={class:"mb-3"},ie={style:{display:"flex","justify-content":"start"}},de={key:0},we={class:"grid gap-0 column-gap-3"},ue=["value"],fe={class:"mb-3"},ce={class:"grid gap-0 column-gap-3"},ge={class:"col"},me={key:1,class:"btn btn-success",style:{margin:"3px"}},ke={class:"mb-3"},Se={class:"mb-3"},pe={class:"modal-footer"},ve=C({__name:"WorkflowStageForm",props:{mode:{},workflowStageIdx:{},workflowStageName:{}},emits:["get-workflow-stage-list"],setup(s,{emit:N}){const l=D(),c=d(),g=d(),r=s,k=N,i=$(()=>r.workflowStageIdx),W=$(()=>r.workflowStageName),m=d(!1);F(i,async()=>{b(),await w()}),E(async()=>{c.value&&(g.value=new z(c.value)),b(),await w()});const t=d({}),w=async()=>{m.value=!0,r.mode==="new"?(t.value.workflowStageIdx=0,t.value.workflowStageTypeIdx=0,t.value.workflowStageTypeName="",t.value.workflowStageName="",t.value.workflowStageDesc="",t.value.workflowStageContent="",t.value.workflowStageOrder=0,p.value=!1,S.value=!1,m.value=!1,console.log("isInitializing",m.value)):await Q(r.workflowStageIdx).then(a=>{t.value=a.data,p.value=!0,m.value=!1})},y=d([]),b=async()=>{try{const{data:a}=await J();y.value=a}catch(a){console.log(a)}},S=d(!1),V=async()=>{S.value=!S.value,t.value.workflowStageTypeIdx=0,t.value.workflowStageTypeName=""},B=async()=>{p.value=!1,y.value.forEach(a=>{t.value.workflowStageTypeIdx===a.workflowStageTypeIdx&&(t.value.workflowStageTypeName=a.workflowStageTypeName)}),await I(t.value.workflowStageTypeName)},I=async a=>{const{data:o}=await te(a);t.value.workflowStageContent=o[0].workflowStageContent},p=d(!1),M=async()=>{const a={workflowStageName:t.value.workflowStageName,workflowStageTypeName:t.value.workflowStageTypeName},{data:o}=await X(a);o?l.error("Name is already in use."):(l.success("Name is available."),p.value=!0)};F(()=>[t.value.workflowStageName,t.value.workflowStageTypeName],()=>{if(!m.value){if(W.value===t.value.workflowStageName){p.value=!0;return}p.value=!1}});const P=async()=>{if(!S.value&&(!t.value.workflowStageTypeIdx||t.value.workflowStageTypeIdx===0)){l.error("Please select Workflow Stage Type.");return}if(S.value&&!t.value.workflowStageTypeName){l.error("Please enter new Workflow Stage Type.");return}if(!t.value.workflowStageName){l.error("Please enter Workflow Stage Name.");return}if(!p.value){l.error("Please perform duplicate check.");return}if(!t.value.workflowStageContent){l.error("Please enter Script.");return}let a=!1;r.mode==="new"?a=await U():a=await A(),a&&(k("get-workflow-stage-list"),w(),g.value&&(g.value.hide(),setTimeout(()=>{document.body.classList.remove("modal-open");const o=document.querySelector(".modal-backdrop");o==null||o.remove()},150)))},U=async()=>{try{const{data:a}=await Y(t.value);return a?(l.success("Registered successfully."),!0):(l.error("Failed to register."),!1)}catch{return l.error("Failed to register."),!1}},A=async()=>{try{const{data:a}=await Z(t.value);return a?(l.success("Updated successfully."),!0):(l.error("Failed to update."),!1)}catch{return l.error("Failed to update."),!1}};return(a,o)=>(f(),u("div",{class:"modal modal-blur fade",id:"workflowStageForm",tabindex:"-1","aria-hidden":"true",ref_key:"modalElement",ref:c},[e("div",oe,[e("div",ae,[e("div",le,[e("h3",se,h(r.mode==="new"?"New":"Edit")+" Workflow Stage",1),o[8]||(o[8]=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),e("div",re,[e("div",null,[e("div",ne,[e("div",ie,[o[10]||(o[10]=e("label",{class:"form-label required col"}," Workflow Stage Type ",-1)),r.mode==="new"?(f(),u("div",de,[e("input",{type:"checkBox",onChange:V},null,32),o[9]||(o[9]=e("label",{class:"ms-2"},"Add Workflow Type",-1))])):G("",!0)]),e("div",we,[S.value?T((f(),u("input",{key:1,type:"text",class:"form-control p-2 g-col-12",placeholder:"Please enter the Workflow Stage type you want to add","onUpdate:modelValue":o[1]||(o[1]=n=>t.value.workflowStageTypeName=n),onFocusout:o[2]||(o[2]=n=>I(t.value.workflowStageTypeName))},null,544)),[[_,t.value.workflowStageTypeName]]):T((f(),u("select",{key:0,"onUpdate:modelValue":o[0]||(o[0]=n=>t.value.workflowStageTypeIdx=n),class:"form-select p-2 g-col-12",onChange:B},[o[11]||(o[11]=e("option",{value:0},"Select Workflow Stage Type",-1)),(f(!0),u(L,null,H(y.value,(n,q)=>(f(),u("option",{value:n.workflowStageTypeIdx,key:q},h(n.workflowStageTypeName),9,ue))),128))],544)),[[O,t.value.workflowStageTypeIdx]])])]),e("div",fe,[o[12]||(o[12]=e("label",{class:"form-label required"},"Workflow Stage Name",-1)),e("div",ce,[T(e("input",{type:"text",class:"form-control p-2 g-col-11",placeholder:"Enter the Workflow Stage Name","onUpdate:modelValue":o[3]||(o[3]=n=>t.value.workflowStageName=n)},null,512),[[_,t.value.workflowStageName]]),e("div",ge,[p.value?(f(),u("button",me,"Duplicate Check")):(f(),u("button",{key:0,class:"btn btn-primary chk",onClick:M},"Duplicate Check"))])])]),e("div",ke,[o[13]||(o[13]=e("label",{class:"form-label"},"Workflow Stage Description",-1)),T(e("input",{type:"text",class:"form-control p-2 g-col-11",placeholder:"Enter the Workflow Stage Description","onUpdate:modelValue":o[4]||(o[4]=n=>t.value.workflowStageDesc=n)},null,512),[[_,t.value.workflowStageDesc]])]),e("div",Se,[o[14]||(o[14]=e("label",{class:"form-label required"},"Script",-1)),T(e("textarea",{rows:"10",class:"form-control p-2 g-col-11",placeholder:"Enter the Script","onUpdate:modelValue":o[5]||(o[5]=n=>t.value.workflowStageContent=n)},null,512),[[_,t.value.workflowStageContent]])])])]),e("div",pe,[e("button",{type:"button",class:"btn btn-link link-secondary","data-bs-dismiss":"modal",onClick:o[6]||(o[6]=n=>w())}," Cancel "),e("button",{type:"button",class:"btn btn-primary ms-auto",onClick:o[7]||(o[7]=n=>P())},h(r.mode==="new"?"Regist":"Edit"),1)])])])],512))}}),ye={class:"modal modal-blur fade",id:"deleteWorkflowStage",tabindex:"-1","aria-hidden":"true"},be={class:"modal-dialog modal-lg modal-dialog-centered",role:"document"},Ne={class:"modal-content"},Te={class:"modal-body py-4"},We={class:"modal-footer"},_e=C({__name:"DeleteWorkflowStage",props:{workflowStageName:{},workflowStageIdx:{}},emits:["get-workflow-stage-list"],setup(s,{emit:N}){const l=D(),c=s,g=N,r=async()=>{const{data:k}=await ee(c.workflowStageIdx);k?l.success("삭제되었습니다."):l.error("삭제하지 못했습니다."),g("get-workflow-stage-list")};return(k,i)=>(f(),u("div",ye,[e("div",be,[e("div",Ne,[i[2]||(i[2]=e("div",{class:"modal-status bg-danger"},null,-1)),i[3]||(i[3]=e("div",{class:"modal-header"},[e("h3",{class:"modal-title"},"Delete Workflow Stage"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",Te,[e("h4",null,"Are you sure you want to delete "+h(c.workflowStageName)+"?",1)]),e("div",We,[i[1]||(i[1]=e("a",{href:"#",class:"btn btn-link link-secondary","data-bs-dismiss":"modal"}," Cancel ",-1)),e("a",{href:"#",class:"btn btn-primary ms-auto","data-bs-dismiss":"modal",onClick:i[0]||(i[0]=W=>r())}," Delete ")])])])]))}}),xe={class:"card card-flush w-100"},Ie=C({__name:"WorkflowStageList",setup(s){const N=D(),l=d([]),c=d([]);E(async()=>{i(),await g()});const g=async()=>{try{const{data:w}=await K();l.value=w}catch(w){console.log(w),N.error("데이터를 가져올 수 없습니다.")}},r=d(0),k=d(""),i=()=>{c.value=[{title:"Stage Type",field:"workflowStageTypeName",width:"27%"},{title:"Stage Name",field:"workflowStageName",width:"27%"},{title:"Stage Desc",field:"workflowStageDesc",width:"26%"},{title:"Action",width:"20%",formatter:W,cellClick:function(w,y){const b=w.target,S=b==null?void 0:b.getAttribute("id");r.value=y.getRow().getData().workflowStageIdx,k.value=y.getRow().getData().workflowStageName,S==="edit-btn"&&(m.value="edit")}}]},W=()=>`
  <div>
    <button
      class='btn btn-primary d-none d-sm-inline-block mr-5'
      id='edit-btn'
      data-bs-toggle='modal' 
      data-bs-target='#workflowStageForm'>
      EDIT
    </button>
    <button
      class='btn btn-danger d-none d-sm-inline-block'
      id='delete-btn'
      data-bs-toggle='modal' 
      data-bs-target='#deleteWorkflowStage'>
      DELETE
    </button>
  </div>`,m=d("new"),t=()=>{r.value=0,m.value="new"};return(w,y)=>(f(),u(L,null,[x(R,{"header-title":"Workflow Stage","new-btn-title":"New Stage","popup-flag":!0,"popup-target":"#workflowStageForm",class:"mb-3",onClickNewBtn:t}),e("div",xe,[x(j,{columns:c.value,"table-data":l.value},null,8,["columns","table-data"]),x(ve,{mode:m.value,"workflow-stage-idx":r.value,"workflow-stage-name":k.value,onGetWorkflowStageList:g},null,8,["mode","workflow-stage-idx","workflow-stage-name"]),x(_e,{"workflow-stage-name":k.value,"workflow-stage-idx":r.value,onGetWorkflowStageList:g},null,8,["workflow-stage-name","workflow-stage-idx"])])],64))}});export{Ie as default};
