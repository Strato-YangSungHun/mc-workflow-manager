import{_ as B}from"./TableHeader.vue_vue_type_script_setup_true_lang-CUolK4Cr.js";import{s as p,_ as M}from"./request-C-BvNnw2.js";import{d as C,u as D,r as i,c as U,w as q,o as $,M as A,a as u,b as e,t as h,j as R,e as N,v as j,F as G,f as O,g as _,h as c,i as x}from"./index-dNEY-gCr.js";const z=()=>p.get("/workflowStageType/list"),H=()=>p.get("/workflowStage/list");function J(s){return p.get("/workflowStage/"+s)}function K(s){return p.get(`/workflowStage/duplicate?workflowStageName=${s.workflowStageName}&workflowStageTypeName=${s.workflowStageTypeName}`)}function Q(s){return p.post("/workflowStage",s)}function X(s){return p.patch(`/workflowStage/${s.workflowStageIdx}`,s)}function Y(s){return p.delete(`/workflowStage/${s}`)}function Z(s){return p.get(`/workflowStage/default/script/${s}`)}const ee={class:"modal-dialog modal-lg modal-dialog-centered",role:"document"},te={class:"modal-content"},oe={class:"modal-header"},ae={class:"modal-title"},le={class:"modal-body py-4"},se={class:"mb-3"},re={style:{display:"flex","justify-content":"start"}},ne={key:0},de={class:"grid gap-0 column-gap-3"},ie=["value"],we={class:"mb-3"},ue={class:"grid gap-0 column-gap-3"},ce={class:"col"},fe={key:1,class:"btn btn-success",style:{margin:"3px"}},ge={class:"mb-3"},me={class:"mb-3"},ke={class:"modal-footer"},pe=C({__name:"WorkflowStageForm",props:{mode:{},workflowStageIdx:{}},emits:["get-workflow-stage-list"],setup(s,{emit:v}){const l=D(),f=i(),g=i(),n=s,S=v,d=U(()=>n.workflowStageIdx);q(d,async()=>{m(),await k()}),$(async()=>{f.value&&(g.value=new A(f.value)),m(),await k()});const t=i({}),k=async()=>{if(n.mode==="new")t.value.workflowStageIdx=0,t.value.workflowStageTypeIdx=0,t.value.workflowStageTypeName="",t.value.workflowStageName="",t.value.workflowStageDesc="",t.value.workflowStageContent="",t.value.workflowStageOrder=0,T.value=!1,w.value=!1;else{const{data:a}=await J(n.workflowStageIdx);t.value=a,T.value=!0}},y=i([]),m=async()=>{try{const{data:a}=await z();y.value=a}catch(a){console.log(a)}},w=i(!1),b=async()=>{w.value=!w.value,t.value.workflowStageTypeIdx=0,t.value.workflowStageTypeName=""},W=async()=>{y.value.forEach(a=>{t.value.workflowStageTypeIdx===a.workflowStageTypeIdx&&(t.value.workflowStageTypeName=a.workflowStageTypeName)}),await I(t.value.workflowStageTypeName)},I=async a=>{const{data:o}=await Z(a);t.value.workflowStageContent=o[0].workflowStageContent},T=i(!1),F=async()=>{const a={workflowStageName:t.value.workflowStageName,workflowStageTypeName:t.value.workflowStageTypeName},{data:o}=await K(a);o?l.error("Name is already in use."):(l.success("Name is available."),T.value=!0)},E=async()=>{if(!w.value&&(!t.value.workflowStageTypeIdx||t.value.workflowStageTypeIdx===0)){l.error("Please select Workflow Stage Type.");return}if(w.value&&!t.value.workflowStageTypeName){l.error("Please enter new Workflow Stage Type.");return}if(!t.value.workflowStageName){l.error("Please enter Workflow Stage Name.");return}if(!T.value){l.error("Please perform duplicate check.");return}if(!t.value.workflowStageDesc){l.error("Please enter Description.");return}if(!t.value.workflowStageContent){l.error("Please enter Script.");return}let a=!1;n.mode==="new"?a=await L():a=await V(),a&&(S("get-workflow-stage-list"),k(),g.value&&(g.value.hide(),setTimeout(()=>{document.body.classList.remove("modal-open");const o=document.querySelector(".modal-backdrop");o==null||o.remove()},150)))},L=async()=>{try{const{data:a}=await Q(t.value);return a?(l.success("Registered successfully."),!0):(l.error("Failed to register."),!1)}catch{return l.error("Failed to register."),!1}},V=async()=>{try{const{data:a}=await X(t.value);return a?(l.success("Updated successfully."),!0):(l.error("Failed to update."),!1)}catch{return l.error("Failed to update."),!1}};return(a,o)=>(c(),u("div",{class:"modal modal-blur fade",id:"workflowStageForm",tabindex:"-1","aria-hidden":"true",ref_key:"modalElement",ref:f},[e("div",ee,[e("div",te,[e("div",oe,[e("h3",ae,h(n.mode==="new"?"New":"Edit")+" Workflow Stage",1),o[8]||(o[8]=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),e("div",le,[e("div",null,[e("div",se,[e("div",re,[o[10]||(o[10]=e("label",{class:"form-label required col"}," Workflow Stage Type ",-1)),n.mode==="new"?(c(),u("div",ne,[e("input",{type:"checkBox",onChange:b},null,32),o[9]||(o[9]=e("label",{class:"ms-2"},"Add Workflow Type",-1))])):R("",!0)]),e("div",de,[w.value?N((c(),u("input",{key:1,type:"text",class:"form-control p-2 g-col-12",placeholder:"Please enter the Workflow Stage type you want to add","onUpdate:modelValue":o[1]||(o[1]=r=>t.value.workflowStageTypeName=r),onFocusout:o[2]||(o[2]=r=>I(t.value.workflowStageTypeName))},null,544)),[[_,t.value.workflowStageTypeName]]):N((c(),u("select",{key:0,"onUpdate:modelValue":o[0]||(o[0]=r=>t.value.workflowStageTypeIdx=r),class:"form-select p-2 g-col-12",onChange:W},[o[11]||(o[11]=e("option",{value:0},"Select Workflow Stage Type",-1)),(c(!0),u(G,null,O(y.value,(r,P)=>(c(),u("option",{value:r.workflowStageTypeIdx,key:P},h(r.workflowStageTypeName),9,ie))),128))],544)),[[j,t.value.workflowStageTypeIdx]])])]),e("div",we,[o[12]||(o[12]=e("label",{class:"form-label required"},"Workflow Stage Name",-1)),e("div",ue,[N(e("input",{type:"text",class:"form-control p-2 g-col-11",placeholder:"Enter the Workflow Stage Name","onUpdate:modelValue":o[3]||(o[3]=r=>t.value.workflowStageName=r)},null,512),[[_,t.value.workflowStageName]]),e("div",ce,[T.value?(c(),u("button",fe,"Duplicate Check")):(c(),u("button",{key:0,class:"btn btn-primary chk",onClick:F},"Duplicate Check"))])])]),e("div",ge,[o[13]||(o[13]=e("label",{class:"form-label required"},"Workflow Stage Description",-1)),N(e("input",{type:"text",class:"form-control p-2 g-col-11",placeholder:"Enter the Workflow Stage Description","onUpdate:modelValue":o[4]||(o[4]=r=>t.value.workflowStageDesc=r)},null,512),[[_,t.value.workflowStageDesc]])]),e("div",me,[o[14]||(o[14]=e("label",{class:"form-label required"},"Script",-1)),N(e("textarea",{rows:"10",class:"form-control p-2 g-col-11",placeholder:"Enter the Script","onUpdate:modelValue":o[5]||(o[5]=r=>t.value.workflowStageContent=r)},null,512),[[_,t.value.workflowStageContent]])])])]),e("div",ke,[e("button",{type:"button",class:"btn btn-link link-secondary","data-bs-dismiss":"modal",onClick:o[6]||(o[6]=r=>k())}," Cancel "),e("button",{type:"button",class:"btn btn-primary ms-auto",onClick:o[7]||(o[7]=r=>E())},h(n.mode==="new"?"Regist":"Edit"),1)])])])],512))}}),Se={class:"modal modal-blur fade",id:"deleteWorkflowStage",tabindex:"-1","aria-hidden":"true"},ve={class:"modal-dialog modal-lg modal-dialog-centered",role:"document"},ye={class:"modal-content"},be={class:"modal-body py-4"},Te={class:"modal-footer"},Ne=C({__name:"DeleteWorkflowStage",props:{workflowStageName:{},workflowStageIdx:{}},emits:["get-workflow-stage-list"],setup(s,{emit:v}){const l=D(),f=s,g=v,n=async()=>{const{data:S}=await Y(f.workflowStageIdx);S?l.success("삭제되었습니다."):l.error("삭제하지 못했습니다."),g("get-workflow-stage-list")};return(S,d)=>(c(),u("div",Se,[e("div",ve,[e("div",ye,[d[2]||(d[2]=e("div",{class:"modal-status bg-danger"},null,-1)),d[3]||(d[3]=e("div",{class:"modal-header"},[e("h3",{class:"modal-title"},"Delete Workflow Stage"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",be,[e("h4",null,"Are you sure you want to delete "+h(f.workflowStageName)+"?",1)]),e("div",Te,[d[1]||(d[1]=e("a",{href:"#",class:"btn btn-link link-secondary","data-bs-dismiss":"modal"}," Cancel ",-1)),e("a",{href:"#",class:"btn btn-primary ms-auto","data-bs-dismiss":"modal",onClick:d[0]||(d[0]=t=>n())}," Delete ")])])])]))}}),We={class:"card card-flush w-100"},Ce=C({__name:"WorkflowStageList",setup(s){const v=D(),l=i([]),f=i([]);$(async()=>{d(),await g()});const g=async()=>{try{const{data:m}=await H();l.value=m}catch(m){console.log(m),v.error("데이터를 가져올 수 없습니다.")}},n=i(0),S=i(""),d=()=>{f.value=[{title:"Stage Type",field:"workflowStageTypeName",width:"27%"},{title:"Stage Name",field:"workflowStageName",width:"27%"},{title:"Stage Desc",field:"workflowStageDesc",width:"26%"},{title:"Action",width:"20%",formatter:t,cellClick:function(m,w){const b=m.target,W=b==null?void 0:b.getAttribute("id");n.value=w.getRow().getData().workflowStageIdx,W==="edit-btn"?k.value="edit":W==="delete-btn"&&(S.value=w.getRow().getData().workflowStageName)}}]},t=()=>`
  <div>
    <button
      class='btn btn-primary d-none d-sm-inline-block mr-5'
      id='edit-btn'
      data-bs-toggle='modal' 
      data-bs-target='#workflowStageForm'>
      EDIT
    </button>
    <button
      class='btn btn-danger d-none d-sm-inline-block'
      id='delete-btn'
      data-bs-toggle='modal' 
      data-bs-target='#deleteWorkflowStage'>
      DELETE
    </button>
  </div>`,k=i("new"),y=()=>{n.value=0,k.value="new"};return(m,w)=>(c(),u("div",We,[x(B,{"header-title":"Workflow Stage","new-btn-title":"New Stage","popup-flag":!0,"popup-target":"#workflowStageForm",onClickNewBtn:y}),x(M,{columns:f.value,"table-data":l.value},null,8,["columns","table-data"]),x(pe,{mode:k.value,"workflow-stage-idx":n.value,onGetWorkflowStageList:g},null,8,["mode","workflow-stage-idx"]),x(Ne,{"workflow-stage-name":S.value,"workflow-stage-idx":n.value,onGetWorkflowStageList:g},null,8,["workflow-stage-name","workflow-stage-idx"])]))}});export{Ce as default};
